---
- name: D√©ploiement AdSecureCheck via install.sh
  hosts: production
  become: yes
  gather_facts: yes
  vars_files:
    - ../group_vars/all.yml

  tasks:
    - name: V√©rifier que git est install√©
      apt:
        name: git
        state: present
        update_cache: yes

    - name: V√©rifier que curl est install√©
      apt:
        name: curl
        state: present
        update_cache: yes

    - name: Cloner le d√©p√¥t Git si n√©cessaire
      git:
        repo: "https://github.com/SH0000T/Sae502.git"
        dest: "{{ project_path | default('/home/{{ ansible_user }}/AdSecureCheck') }}"
        version: "main"
        update: yes

    - name: S'assurer que le script install.sh est ex√©cutable
      file:
        path: "{{ project_path | default('/home/{{ ansible_user }}/AdSecureCheck') }}/install.sh"
        mode: '0755'

    - name: Lancer le script install.sh
      command: "{{ project_path | default('/home/{{ ansible_user }}/AdSecureCheck') }}/install.sh"
      args:
        chdir: "{{ project_path | default('/home/{{ ansible_user }}/AdSecureCheck') }}"

    - name: Afficher le message final
      debug:
        msg:
          - "=============================================="
          - "‚úÖ D√âPLOIEMENT TERMIN√â AVEC SUCC√àS !"
          - "üåê Frontend: http://{{ ansible_host }}:{{ frontend_port | default('3000') }}"
          - "üîå API Backend: http://{{ ansible_host }}:{{ api_port | default('5000') }}/api/health"
          - "=============================================="
