---
- name: D√©ploiement complet d'AdSecureCheck
  hosts: production
  become: yes
  gather_facts: yes
  vars_files:
    - ../group_vars/all.yml

  tasks:
    - name: Affichage des informations du syst√®me
      debug:
        msg:
          - "Syst√®me: {{ ansible_distribution }} {{ ansible_distribution_version }}"
          - "Hostname: {{ ansible_hostname }}"
          - "User: {{ ansible_user }}"

    - name: Installation des packages de base
      include_role:
        name: common

    - name: Installation et configuration de Docker
      include_role:
        name: docker

    - name: Configuration du pare-feu UFW
      include_role:
        name: firewall

    - name: D√©ploiement de l'application
      include_role:
        name: app

    - name: R√©sum√© du d√©ploiement
      debug:
        msg:
          - "=============================================="
          - "‚úÖ D√âPLOIEMENT TERMIN√â AVEC SUCC√àS !"
          - "=============================================="
          - ""
          - "üåê Frontend: http://{{ ansible_host }}:{{ frontend_port }}"
          - "üîå API Backend: http://{{ ansible_host }}:{{ api_port }}/api/health"
          - "üóÑÔ∏è  Base de donn√©es: PostgreSQL sur port {{ db_port }}"
          - ""
          - "üìã Commandes utiles:"
          - "  - Voir les conteneurs: docker ps"
          - "  - Voir les logs: docker logs adsecure-backend"
          - "  - Arr√™ter: cd {{ project_path }} && docker compose down"
          - "  - Red√©marrer: cd {{ project_path }} && docker compose up -d"
          - ""
          - "=============================================="
